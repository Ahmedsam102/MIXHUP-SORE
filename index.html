<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MIXHUP STORE - Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
<style>
:root{
  --bg:#0e0e0e; --panel:#151515; --card:#1a1a1a; --muted:#aaa; --accent:#ff4c4c;
}
*{box-sizing:border-box}
body{margin:0;font-family:Tahoma,Arial;background:var(--bg);color:#ddd;line-height:1.4}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:#000;border-bottom:1px solid #222}
header h1{margin:0;font-size:18px;color:var(--accent)}
.top-actions{display:flex;gap:8px;align-items:center}
.btn{background:#222;border:1px solid #333;color:#ddd;padding:8px 12px;border-radius:8px;cursor:pointer}
.btn:hover{background:var(--accent);color:#111}
.container{max-width:1200px;margin:18px auto;padding:0 16px}
.layout{display:flex;gap:20px;align-items:flex-start}
.admin-panel{width:360px;background:var(--panel);padding:16px;border-radius:12px;border:1px solid #222}
.admin-panel h2{margin:0 0 12px;color:var(--accent)}
.admin-grid{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
.form-row{margin-bottom:10px}
label{display:block;margin-bottom:6px;color:var(--muted);font-size:13px}
input[type=text], input[type=number], select, textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #333;background:#0f0f0f;color:#ddd}
textarea{min-height:70px;resize:vertical}
.small{font-size:13px;color:var(--muted)}
.main-area{flex:1}
.controls{display:flex;gap:10px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
.search{flex:1;display:flex}
.search input{flex:1;padding:8px;border-radius:8px;border:1px solid #333;background:#0f0f0f;color:#ddd}
.cards{display:flex;flex-wrap:wrap;gap:16px}
.product-card{width:300px;background:var(--card);border:1px solid #222;padding:12px;border-radius:12px}
.product-card img{width:100%;display:block;border-radius:8px}
.prod-title{display:flex;justify-content:space-between;align-items:center;margin:8px 0}
.price{color:#fff;font-weight:700}
.old-price{color:var(--muted);text-decoration:line-through;font-size:13px;margin-left:8px}
.mini{font-size:13px;color:var(--muted)}
.prod-opts{display:flex;gap:8px;margin-top:8px}
.prod-opts select, .prod-opts input[type=number]{width:50%}
.card-actions{display:flex;gap:8px;margin-top:10px}
.card-actions .btn{flex:1}
.cart-floating{position:fixed;top:20px;left:20px;width:300px;background:#000;border:1px solid #222;border-radius:10px;padding:10px;z-index:60}
.cart-items{max-height:300px;overflow:auto;margin:8px 0}
.cart-row{display:flex;justify-content:space-between;gap:6px;padding:6px 0;border-bottom:1px dashed #222}
.invoice{background:#0b0b0b;padding:12px;border-radius:8px;border:1px solid #222}
.footer{margin-top:20px;text-align:center;color:var(--muted);font-size:13px}
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:100}
.modal{background:#111;padding:16px;border-radius:10px;max-width:720px;width:100%;border:1px solid #222}
.row{display:flex;gap:8px}
@media (max-width:980px){
  .layout{flex-direction:column}
  .admin-panel{width:100%}
}
</style>
</head>
<body>

<header>
  <h1>MIXHUP STORE â€” Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h1>
  <div class="top-actions">
    <div id="adminStatus" class="small">Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¯Ù…Ù†: <span id="adminName" class="mini">ØºÙŠØ± Ù…Ø³Ø¬Ù„</span></div>
    <button id="loginBtn" class="btn">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø£Ø¯Ù…Ù†</button>
    <button id="logoutBtn" class="btn" style="display:none">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  </div>
</header>

<div class="container">
  <div class="layout">
    <aside class="admin-panel" id="adminPanel" style="display:none">
      <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ù„Ø£Ø¯Ù…Ù†)</h2>
      <div class="admin-grid">
        <button class="btn" onclick="openAddForm()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
        <button class="btn" id="maintenanceToggle" onclick="toggleMaintenance()">ğŸ”§ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</button>
        <button class="btn" id="toggleOrdersBtn" onclick="toggleOrderAccept()">ğŸ“¦ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        <button class="btn" onclick="togglePrices()">ğŸ’² Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
        <button class="btn" onclick="clearAllProducts()">ğŸ—‘ï¸ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
        <button class="btn" onclick="viewOrders()">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
      </div>

      <hr style="border-color:#222">
      <div style="margin-top:8px;">
        <h3 class="small">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬</h3>
        <div class="form-row">
          <label>Ø§Ù„Ø§Ø³Ù…</label>
          <input id="p_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        </div>
        <div class="form-row">
          <label>Ø§Ù„Ø³Ø¹Ø± (Ø¬)</label>
          <input id="p_price" type="number" placeholder="Ù…Ø«Ø§Ù„: 150">
        </div>
        <div class="form-row">
          <label>Ø³Ø¹Ø± Ù‚Ø¯ÙŠÙ… Ø§Ø®ØªÙŠØ§Ø±ÙŠ</label>
          <input id="p_oldprice" type="number" placeholder="Ù…Ø«Ø§Ù„: 200">
        </div>
        <div class="form-row">
          <label>Ù†Ø³Ø¨Ø© Ø®ØµÙ…</label>
          <input id="p_discount" type="number" value="0">
        </div>
        <div class="form-row">
          <label>Ø§Ù„ÙˆØµÙ</label>
          <textarea id="p_desc" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ±"></textarea>
        </div>
        <div class="form-row">
          <label>Ø§Ù„ÙØ¦Ø©/Ø§Ù„Ù‚Ø³Ù…</label>
          <input id="p_category" placeholder="Ù…Ø«Ù„: Ù…Ù„Ø§Ø¨Ø³ØŒ Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª">
        </div>
        <div class="form-row">
          <label>ØµÙˆØ± (Ø±Ø§Ø¨Ø· ÙƒÙ„ ØµÙˆØ±Ø© Ù…ÙØµÙˆÙ„ Ø¨ÙØ§ØµÙ„Ø©)</label>
          <input id="p_images" placeholder="https://... , https://...">
        </div>
        <div class="form-row">
          <label>Ø£Ù„ÙˆØ§Ù† Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©</label>
          <input id="p_colors" placeholder="Ø£Ø³ÙˆØ¯,Ø£Ø­Ù…Ø±,Ø£Ø²Ø±Ù‚">
        </div>
        <div class="form-row">
          <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©</label>
          <input id="p_stock" type="number" value="10">
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn" onclick="saveProduct()">âœ”ï¸ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
          <button class="btn" onclick="closeAddForm()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
        <input id="editingIndex" type="hidden" value="-1">
      </div>
    </aside>

    <main class="main-area">
      <div class="controls">
        <div class="search">
          <input id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø£Ùˆ Ù‚Ø³Ù…..." oninput="renderProducts()" />
        </div>
        <select id="filterCategory" onchange="renderProducts()">
          <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
        </select>
        <div style="display:flex;gap:8px">
          <button class="btn" onclick="openCart()">ğŸ›’ Ø§ÙØªØ­ Ø§Ù„Ø¹Ø±Ø¨Ø©</button>
        </div>
      </div>
      <div id="productsArea" class="cards"></div>
      <div class="footer">
        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© MIXHUP STORE 2025</p>
      </div>
    </main>
  </div>
</div>

<div id="cartIcon" style="position:fixed;bottom:20px;left:20px;background:#222;padding:12px;border-radius:50%;cursor:pointer;z-index:9999;box-shadow:0 0 10px #000;font-size:22px;">
  ğŸ›’
</div>

<div id="cartBox" style="position:fixed;bottom:80px;left:20px;background:#111;padding:15px;border-radius:10px;width:260px;max-height:350px;overflow-y:auto;display:none;z-index:9999;box-shadow:0 0 15px #000;">
  <h3 style="margin-top:0">Ø§Ù„Ø¹Ø±Ø¨Ø©</h3>
  <div class="cart-items" id="cartItems"></div>
  <div style="display:flex;justify-content:space-between;margin-top:10px">
    <span style="font-size:14px;color:#aaa">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
    <span id="cartTotal" style="font-weight:700;font-size:18px">0 Ø¬</span>
  </div>
  <div style="display:flex;gap:8px;margin-top:12px">
    <button class="btn" style="flex:1" onclick="checkout()">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
    <button class="btn" style="flex:1" onclick="clearCart()">ØªÙØ±ÙŠØº</button>
  </div>
</div>

<div id="modal" class="modal-back" onclick="closeModal(event)">
  <div class="modal" role="dialog" onclick="event.stopPropagation()">
    <h3 id="modalTitle">ØªÙØ§ØµÙŠÙ„</h3>
    <div id="modalBody"></div>
    <div style="text-align:left;margin-top:12px">
      <button class="btn" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>
</div>

<div id="recaptcha-container"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDJ8lh1VMcTBNtppdvIMtDYeWw2Wua1mug",
  authDomain: "mix-hup.firebaseapp.com",
  databaseURL: "https://mix-hup-default-rtdb.firebaseio.com",
  projectId: "mix-hup",
  storageBucket: "mix-hup.appspot.com",
  messagingSenderId: "849768306890",
  appId: "1:849768306890:web:f3a1ad367337aaefe17c33"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();
window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container',{size:'invisible'});

// ======= Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ…ØªØ¬Ø± =======
let isAdmin=false;
let settings={maintenanceMode:false,acceptOrders:true,hidePrices:false,adminPass:"admin123"};
let products=[];
let cart=[];
let orders=[];

// ======= ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¯Ù…Ù† =======
function renderAdminUI(){
  const panel=document.getElementById("adminPanel");
  const loginBtn=document.getElementById("loginBtn");
  const logoutBtn=document.getElementById("logoutBtn");
  const adminName=document.getElementById("adminName");
  if(isAdmin){ panel.style.display="block"; loginBtn.style.display="none"; logoutBtn.style.display="inline-block"; adminName.textContent="Ù…Ø³Ø¬Ù„"; }
  else{ panel.style.display="none"; loginBtn.style.display="inline-block"; logoutBtn.style.display="none"; adminName.textContent="ØºÙŠØ± Ù…Ø³Ø¬Ù„"; }
}

// ======= ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase =======
function loadData(){
  db.ref("/settings").on("value",snap=>{ if(snap.exists()) settings={...settings,...snap.val()}; });
  db.ref("/products").on("value",snap=>{
    products = snap.exists()? Object.values(snap.val()):[];
    updateCategoryFilter();
    renderProducts();
  });
  db.ref("/orders").on("value",snap=>{ orders = snap.exists()? Object.values(snap.val()):[]; });
}

// ======= ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† =======
document.getElementById("loginBtn").addEventListener("click",()=>{
  const pass=prompt("Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø¯Ù…Ù†")||"";
  if(pass===settings.adminPass){ isAdmin=true; renderAdminUI(); alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!"); }
  else alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
});
document.getElementById("logoutBtn").addEventListener("click",()=>{
  isAdmin=false; renderAdminUI(); alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
});

// ======= Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª =======
function openAddForm(){
  document.getElementById("editingIndex").value="-1"; 
  document.getElementById("p_name").value=""; document.getElementById("p_price").value="";
  document.getElementById("p_oldprice").value=""; document.getElementById("p_desc").value="";
  document.getElementById("p_category").value=""; document.getElementById("p_images").value="";
  document.getElementById("p_colors").value=""; document.getElementById("p_stock").value=10; 
  window.scrollTo({top:0,behavior:"smooth"});
}
function closeAddForm(){ openAddForm(); }

function saveProduct(){
  const name=document.getElementById("p_name").value.trim();
  if(!name){ alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"); return; }

  const prod = {
    name,
    price:Number(document.getElementById("p_price").value)||0,
    oldPrice:Number(document.getElementById("p_oldprice").value)||0,
    discount:Number(document.getElementById("p_discount").value)||0,
    desc:document.getElementById("p_desc").value,
    category:document.getElementById("p_category").value||"Ø¹Ø§Ù…",
    images:document.getElementById("p_images").value.split(",").map(s=>s.trim()).filter(s=>s),
    colors:document.getElementById("p_colors").value.split(",").map(s=>s.trim()).filter(s=>s),
    stock:Number(document.getElementById("p_stock").value)||0,
    visible:true
  };

  const idx = Number(document.getElementById("editingIndex").value);
  if(idx>=0){
    db.ref("/products/"+idx).set(prod);
  } else {
    db.ref("/products").push(prod);
  }

  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬");
  openAddForm();
}

// ======= Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª =======
function calcFinalPrice(p){ let price=Number(p.price)||0; if(p.discount>0) price=Math.round(price*(1-p.discount/100)); return price; }

function renderProducts(){
  const area=document.getElementById("productsArea"); area.innerHTML="";
  const q=document.getElementById("searchInput").value.trim().toLowerCase();
  const cat=document.getElementById("filterCategory").value;
  products.forEach((p,idx)=>{
    if(!p.visible) return;
    if(q && !(p.name+" "+p.desc+" "+p.category).toLowerCase().includes(q)) return;
    if(cat && p.category!==cat) return;
    const final=calcFinalPrice(p);
    const oldPriceHtml=(p.oldPrice && !settings.hidePrices)? `<span class="old-price">${p.oldPrice} Ø¬</span>` : "";
    const discountHtml=(p.discount>0)? `<div class="mini">Ø®ØµÙ… ${p.discount}%</div>` : "";
    const images=(p.images && p.images.length)?p.images:["https://via.placeholder.com/600x400?text=No+Image"];
    const firstImage=images[0];
    const card=document.createElement("div"); card.className="product-card";
    card.innerHTML=`
      <div class="slider"><img src="${firstImage}" alt="${p.name}"></div>
      <div style="margin-top:8px">
        <div class="prod-title">
          <div>
            <div style="font-size:15px">${p.name}</div>
            <div class="mini">${p.category} â€¢ ${p.desc}</div>
          </div>
          <div style="text-align:left">
            <div class="price">${settings.hidePrices?"â€”":final+" Ø¬"}</div>${oldPriceHtml}${discountHtml}
          </div>
        </div>
        <div class="prod-opts">
          <select class="color-select" id="color-${idx}">${p.colors.map(c=>`<option>${c}</option>`).join("")}</select>
          <input type="number" id="qty-${idx}" value="1" min="1" max="${p.stock}">
        </div>
        <div class="card-actions">
          <button class="btn" onclick="addToCart(${idx})">Ø£Ø¶Ù Ù„Ù„Ø¹Ø±Ø¨Ø©</button>
        </div>
      </div>
    `;
    area.appendChild(card);
  });
}

function updateCategoryFilter(){
  const sel=document.getElementById("filterCategory");
  const cats=[...new Set(products.map(p=>p.category))];
  sel.innerHTML='<option value="">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>'+cats.map(c=>`<option value="${c}">${c}</option>`).join("");
}

// ======= Ø§Ù„Ø¹Ø±Ø¨Ø© =======
document.getElementById("cartIcon").addEventListener("click",()=>{ toggleCart(); });
function openCart(){ document.getElementById("cartBox").style.display="block"; renderCart(); }
function toggleCart(){ const box=document.getElementById("cartBox"); box.style.display=(box.style.display==="block")?"none":"block"; renderCart(); }
function addToCart(idx){
  const p=products[idx]; if(!p) return;
  const qty=Number(document.getElementById(`qty-${idx}`).value)||1;
  const color=document.getElementById(`color-${idx}`).value||"";
  const existing=cart.find(c=>c.idx===idx && c.color===color);
  if(existing) existing.qty+=qty; else cart.push({idx,qty,color});
  renderCart();
}
function renderCart(){
  const div=document.getElementById("cartItems"); div.innerHTML="";
  let total=0;
  cart.forEach(c=>{
    const p=products[c.idx]; if(!p) return;
    const final=calcFinalPrice(p);
    total+=final*c.qty;
    const row=document.createElement("div"); row.className="cart-row";
    row.innerHTML=`<span>${p.name} ${c.color?`(${c.color})`:''} x${c.qty}</span><span>${final*c.qty} Ø¬</span>`;
    div.appendChild(row);
  });
  document.getElementById("cartTotal").textContent=total+" Ø¬";
}
function clearCart(){ cart=[]; renderCart(); }
function checkout(){
  if(cart.length===0){ alert("Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©"); return; }
  const name=prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:")||"Ø²Ø§Ø¦Ø±";
  const phone=prompt("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:")||"00000000000";
  const order={name,phone,items:cart.map(c=>({...c})),timestamp:Date.now()};
  db.ref("/orders").push(order);
  alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨!"); cart=[]; renderCart();
}

// ======= Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø£Ø¯Ù…Ù† =======
function toggleMaintenance(){ settings.maintenanceMode=!settings.maintenanceMode; db.ref("/settings/maintenanceMode").set(settings.maintenanceMode); alert("ØªÙ… ØªØºÙŠÙŠØ± ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©"); }
function toggleOrderAccept(){ settings.acceptOrders=!settings.acceptOrders; db.ref("/settings/acceptOrders").set(settings.acceptOrders); alert("ØªÙ… ØªØ´ØºÙŠÙ„/Ø§ÙŠÙ‚Ø§Ù Ø§Ù„Ø·Ù„Ø¨Ø§Øª"); }
function togglePrices(){ settings.hidePrices=!settings.hidePrices; renderProducts(); db.ref("/settings/hidePrices").set(settings.hidePrices); }
function clearAllProducts(){ if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŸ")){ db.ref("/products").remove(); } }
function viewOrders(){ let html=orders.map(o=>`<div>ğŸ§‘ ${o.name} ğŸ“ ${o.phone} â€¢ ${o.items.map(it=>products[it.idx]?.name+" x"+it.qty).join(", ")}</div>`).join(""); showModal("Ø§Ù„Ø·Ù„Ø¨Ø§Øª",html||"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª"); }

// ======= Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ =======
function showModal(title,content){ document.getElementById("modalTitle").textContent=title; document.getElementById("modalBody").innerHTML=content; document.getElementById("modal").style.display="flex"; }
function closeModal(e){ if(e) e.stopPropagation(); document.getElementById("modal").style.display="none"; }

// ======= Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ =======
renderAdminUI(); loadData();
</script>

</body>
</html>
